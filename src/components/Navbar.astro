---
import { Terminal } from "lucide-react";

const isActive = (path: string) => {
  const current = Astro.url.pathname;
  if (path === "/") {
    return current === "/" || current === "";
  }
  return current.startsWith(path);
};
---

<header
  id="navbar-header"
  class="astronav-sticky-header flex flex-row fixed bg-(--bg-main) gap-6 top-0 left-0 w-full z-20 h-10 items-center px-8 sm:px-3 transition-all duration-500">
  <div
    class="title flex cursor-pointer text-2xl align-items-center bg-transparent font-bold">
    <a href="/">
      <Terminal size={25} color="white" />
    </a>
  </div>

  <!-- Navbar -->
  <nav class="container flex mx-60 justify-center px-3 py-2">
    <div class="navbar hidden font-light md:flex items-center text-m">
      <ul class="flex gap-1">
        <li>
          <a
            class:list={[
              "transition duration-300 px-3 py-2 rounded-sm rounded-sm text-(--bg-panel) bg-(--bg-panel) hover:bg-(--hover-muted) hover:text-(--bg-main)",
              { "bg-(--hover-muted)": isActive("/") },
              { "text-(--hover-muted)": !isActive("/") },
              { "bg-(--bg-panel)": !isActive("/") },
            ]}
            href="/">
            Home
          </a>
        </li>
        <li>
          <a
            class:list={[
              "transition duration-300 px-3 py-2 rounded-sm rounded-sm text-(--bg-panel) bg-(--bg-panel) hover:bg-(--hover-muted) hover:text-(--bg-main)",
              { "bg-(--hover-muted)": isActive("/about") },
              { "text-(--hover-muted)": !isActive("/about") },
              { "bg-(--bg-panel)": !isActive("/about") },
            ]}
            href="/about">
            About
          </a>
        </li>
        <li>
          <a
            class:list={[
              "transition duration-300 px-3 py-2 rounded-sm rounded-sm text-(--bg-panel) bg-(--bg-panel) hover:bg-(--hover-muted) hover:text-(--bg-main)",
              { "bg-(--hover-muted)": isActive("/project") },
              { "text-(--hover-muted)": !isActive("/project") },
              { "bg-(--bg-panel)": !isActive("/project") },
            ]}
            href="/project">
            Project
          </a>
        </li>
        <li>
          <a
            class:list={[
              "transition duration-300 px-3 py-2 rounded-sm rounded-sm text-(--bg-panel) bg-(--bg-panel) hover:bg-(--hover-muted) hover:text-(--bg-main)",
              { "bg-(--hover-muted)": isActive("/contact") },
              { "text-(--hover-muted)": !isActive("/contact") },
              { "bg-(--bg-panel)": !isActive("/contact") },
            ]}
            href="/contact">
            Contact
          </a>
        </li>
        <li>
          <a
            class:list={[
              "transition duration-300 px-3 py-2 rounded-sm rounded-sm text-(--bg-panel) bg-(--bg-panel) hover:bg-(--hover-muted) hover:text-(--bg-main)",
              { "bg-(--hover-muted)": isActive("/blog") },
              { "text-(--hover-muted)": !isActive("/blog") },
              { "bg-(--bg-panel)": !isActive("/blog") },
            ]}
            href="/blog">
            Blog
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <button
    id="mobile-menu-btn"
    class="cursor-pointer md:hidden py-2 px-2 text-2xl z-50"
    aria-label="Toggle menu">
    <svg
      id="menu-icon"
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="#ffffff"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-menu">
      <line x1="4" x2="20" y1="12" y2="12"></line><line
        x1="4"
        x2="20"
        y1="6"
        y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line>
    </svg>
    <svg
      id="close-icon"
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="#ffffff"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-x hidden">
      <path d="M18 6 6 18"></path><path d="m6 6 12 12"></path>
    </svg>
  </button>

  <!-- Mobile Nav -->
  <nav
    id="mobile-nav"
    class="fixed top-16 left-0 right-0 font-light bg-[#363636] p-6 md:hidden rounded-b-xl transition-all duration-300 ease-in-out transform -translate-y-full opacity-0 pointer-events-none">
    <ul class="flex flex-col gap-6 text-2xl">
      <li>
        <a
          class:list={[
            { "text-white": isActive("/") },
            { "text-[#a0a0a0]": !isActive("/") },
          ]}
          href="/"
          id="mobile-link-home">Home</a
        >
      </li>
      <li>
        <a
          class:list={[
            { "text-white": isActive("/about") },
            { "text-[#a0a0a0]": !isActive("/about") },
          ]}
          href="/about"
          id="mobile-link-about">About</a
        >
      </li>
      <li>
        <a
          class:list={[
            { "text-white": isActive("/project") },
            { "text-[#a0a0a0]": !isActive("/project") },
          ]}
          href="/project"
          id="mobile-link-project">Project</a
        >
      </li>
      <li>
        <a
          class:list={[
            { "text-white": isActive("/contact") },
            { "text-[#a0a0a0]": !isActive("/contact") },
          ]}
          href="/contact"
          id="mobile-link-contact">Contact</a
        >
      </li>
    </ul>
  </nav>

  <div></div>

  <script lang="ts">
    const header = document.getElementById("navbar-header");
    const mobileMenuBtn = document.getElementById("mobile-menu-btn");
    const mobileNav = document.getElementById("mobile-nav");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");

    let menuOpen = false;

    // Fungsi untuk membuka/menutup menu
    const toggleMenu = () => {
      menuOpen = !menuOpen;
      if (!mobileNav || !menuIcon || !closeIcon) return;
      if (menuOpen) {
        mobileNav.classList.remove(
          "-translate-y-full",
          "opacity-0",
          "pointer-events-none",
        );
        mobileNav.classList.add("translate-y-0", "opacity-100");
        menuIcon.classList.add("hidden");
        closeIcon.classList.remove("hidden");
      } else {
        mobileNav.classList.remove("translate-y-0", "opacity-100");
        mobileNav.classList.add(
          "-translate-y-full",
          "opacity-0",
          "pointer-events-none",
        );
        menuIcon.classList.remove("hidden");
        closeIcon.classList.add("hidden");
      }
    };

    // Event listener untuk tombol menu
    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener("click", toggleMenu);
    }

    // Event listener untuk scroll
    window.addEventListener("scroll", () => {
      const scrollY = window.scrollY;
      if (!header) return;
      // Mengubah warna background dan menambahkan bayangan saat di-scroll
      if (scrollY > 20) {
        header.classList.add(
          "backdrop-blur-lg",
          "bg-[#1C1B1C]/50",
          "shadow-lg",
        );
      } else {
        header.classList.remove(
          "backdrop-blur-lg",
          "bg-[#1C1B1C]/50",
          "shadow-lg",
        );
      }
      // Menyembunyikan/menampilkan header saat di-scroll lebih jauh
      if (scrollY > 200) {
        header.classList.add("opacity-0", "pointer-events-none");
      } else {
        header.classList.remove("opacity-0", "pointer-events-none");
      }
      // Tutup menu jika pengguna scroll
      if (menuOpen && scrollY > 0) {
        toggleMenu();
      }
    });

    // Event listener untuk menutup menu saat tautan di dalamnya diklik
    if (mobileNav) {
      mobileNav.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => {
          if (menuOpen) {
            toggleMenu();
          }
        });
      });
    }
  </script>
</header>
